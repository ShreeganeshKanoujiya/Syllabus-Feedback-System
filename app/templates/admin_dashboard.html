<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Dashboard</title>
    <link rel="icon" type="text/css" href="../static/images/logo_50x50.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-100 flex flex-col">

    <nav class="bg-blue-800 text-white p-4 shadow-lg">
    <h1 class="text-2xl font-bold">Feedback Admin Panel</h1>
</nav>

    <div class="flex flex-1">

    <aside class="w-64 bg-white shadow-lg min-h-screen p-6">
    <h2 class="bg-blue-600 text-white text-lg font-bold mb-4 px-3 py-2 rounded">
        Stakeholders
    </h2>

    <ul class="space-y-2">
        <li>
            <a href="/admin/dashboard"
               class="block px-3 py-2 rounded
               {% if not selected_stakeholder %}bg-blue-100 font-bold{% endif %}">
                All
            </a>
        </li>

        {% for s in stakeholders %}
        <li>
            <a href="/admin/dashboard?stakeholder_id={{ s.stakeholder_id }}"
               class="block px-3 py-2 rounded hover:bg-gray-100
               {% if selected_stakeholder == s.stakeholder_id %}bg-blue-100 font-bold{% endif %}">
                {{ s.stakeholder_type }}
            </a>
        </li>
        {% endfor %}
    </ul>
</aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Total Responses -->
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500">
            <h3 class="text-gray-500 font-semibold">Total Responses</h3>
            <p class="text-4xl font-bold">{{ total_feedback }}</p>
        </div>

        <!-- Chart -->
        <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500">
            <h3 class="text-xl font-bold mb-4">Average Rating per Question</h3>
            <canvas id="feedbackChart"></canvas>
        </div>

    </div>
</main>

    <!-- Chart Script -->
  <script>
{% if mode == "ALL" %}
    const labels = {{ results | map(attribute='label') | list | tojson }};
    const dataValues = {{ results | map(attribute='average_score') | list | tojson }};

    new Chart(document.getElementById("feedbackChart"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Cumulative Average Rating",
                data: dataValues
            }]
        },
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 5,
                    title: {
                        display: true,
                        text: "Average Rating"
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: "Stakeholder"
                    }
                }
            }
        }
    });

{% else %}
    const labels = {{ results | map(attribute='question') | list | tojson }};
    const dataValues = {{ results | map(attribute='average_score') | list | tojson }};

    new Chart(document.getElementById("feedbackChart"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Average Rating per Question",
                data: dataValues
            }]
        },
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 5
                }
            }
        }
    });
{% endif %}
</script>

    </div>
</body>
</html>
